<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:py="http://genshi.edgewall.org/">
<!--
TODO: Include filter for dataset.valuetype and dataset.measured_by. Move page home to /map/kml and use html-get
-->
<head>
	<link href="/media/iconilr.css" rel="stylesheet" type="text/css"/>
	<link href="/media/jquery-ui-1.8.18.custom.css" rel="stylesheet" type="text/css"/>

	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

	<title>schwingbach plot</title>
	
	<script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script>	
	<script type="text/javascript" src="/media/jquery-1.7.1.min.js"></script> 
  <script src="/media/jquery-1.7.1.min.js" type="text/javascript" ></script>
  <script src="/media/jquery-ui-1.8.18.custom.min.js" type="text/javascript" ></script>
  <script src="/media/jquery.json-2.3.min.js" type="text/javascript"></script>

	<script type="text/javascript" src="/html/plot.js">
	</script>
	<script type="text/javascript">
		//<![CDATA[
    $(function() {
			$(".datepicker").datepicker({maxDate:"0", dateFormat: 'dd.mm.yy' });
			$(".timepicker").autocomplete({source: timerange(15)});
			for (var i=0;i<10;i++) {
				popSelect(i);
			}
			$('#addsubplot').removeProp('disabled');
    });
    //]]>
	</script>
	<style type="text/css">
	  .wide {width: 100%;}
	  .filter {width: 10em;}
	  .firstoption {font-style: italic;color: grey;}
	  .small {font-size: small; font-style: italic;}
  	.ui-autocomplete {
			max-height: 100px;
			overflow-y: auto;
			/* prevent horizontal scrollbar */
			overflow-x: hidden;
			/* add padding to account for vertical scrollbar */
			padding-right: 20px;
			font-size: small;
		}
		li.sp {
	    background-color: #E8F0FF;
			border-radius: 0px;
			border-top: 1px solid #000;
		}
		li.line {
			background-color: #FFF;
		}
		.spinner {
			size: 3;
		}
		.leftspace {
			padding-left: 2px;
		}
		ul.brush {
			list-style-image: url(/media/shimmer/brush_16.png)
		}
		ul.box_24 {
			list-style-image: url(/media/plot.png)
		}
		ul.doc {
			list-style-image: url(/media/shimmer/document_16.png)
		}
		span.box {
			padding: 0px;
			background-color: #FFF;
			margin-right: 10px;
		}
		span.box a{
			padding: 0px 2px;
		}
		span.box a:hover {
			background-color:#32739D;
			color:#FFF;
			border-radius: 10px;
			text-decoration: none;
			cursor: hand;
		}
		.tooltip span {
			color: #111;
		}
	</style>
		
</head>
<body>
	<datalist id="numbers"><option py:for="i in xrange(10)" value="${i}"/></datalist>
	${navigation('Plot')}
	<div class="content">
		<div class="error" id="error"></div>
		<h2><a href="javascript:toggle('properties')">&#x25BE; Properties</a>
			<span class="box small leftspace">
				<a href="javascript:$.post('clf',{},seterror);changeprops()" class="tooltip">
					&#x2718;
					<span>removes all lines and subplots of the figure</span>
					clear plot
				</a>
			</span>
		</h2>
		<div id="properties">
			<table class="small" style="display: inline-block">
				<tr>
					<td></td><td>date:</td><td>time:</td><td/><td>size:</td><td/><td>subplots:</td>
				</tr>
				<tr>
					<td>start:</td>
					<td><input class="props datepicker" id="startdate" size="10" value="${formatdate(plot.startdate)}"/></td>
					<td><input class="props timepicker" id="starttime" size="5" value="00:00" /></td>
					<td>w:</td>
					<td><input class="props" type="text" id="plotwidth" size="5" value="${'%g' % (plot.size[0]*100)}"/></td>
					<td>rows:</td>
					<td>
						<input class="props" list="numbers" value="${plot.rows}" id="plotrows" size="2"/>
					</td>
				</tr>
				<tr>
					
					<td>end:</td>
					<td><input class="props datepicker" id="enddate" size="10" value="${formatdate(plot.enddate)}"/></td>
					<td><input class="props timepicker" id="endtime" size="5" value="00:00" /> </td>
					
					<td>h:</td>					
					<td><input class="props" type="text" id="plotheight" size="5" value="${'%g' % (plot.size[1]*100)}"/></td>
					
					<td>cols</td>
					<td><input list="props numbers" value="${plot.columns}" id="plotcolumns" size="2"/></td>					
				</tr>
			</table>

			<!--
				Subplots
			-->
			<ul class="box_24">
				<li py:for="sp in plot.subplots" class="sp">
					subplot ${sp.position} 
					<span class="box small leftspace"> 
						<a py:if="sp.position==len(plot.subplots)" 
							href="javascript:removesubplot(${sp.position})" 
							class="tooltip">
							&#x2718;
							<span>remove subplot ${sp.position} from figure</span>
							remove
					</a>
					</span>
					<ul class="brush">
						<li py:for="i,l in enumerate(sp.lines)" class="small line">
							<span class="small box" id="linetools_${sp.position}_${i}">
								<a href="javascript:removeline(${sp.position},${i})" title="remove line" class="tooltip">
									&#x2718; 
									<span>remove line</span>
								</a>
								<a href="/plot/export.csv?${'subplot=%i&amp;line=%i' % (sp.position,i)}" class="tooltip">
									csv&#x25B8;
									<span>export to csv file...</span>
								</a>
								<a href="javascript:showlinedatasets(${sp.position},${i})" class="tooltip">
									&#x25BE;ds
									<span>show datasets of line</span>
								</a>
								<a href="javascript:reloadline(${sp.position},${i})" class="tooltip">
									&#x21BB;
									<span>Reload this line from the database.</span>
								</a>
							</span>
							${l}
							<ul id="datasetlist_${sp.position}_${i}" class="datasetlist small doc"/>
						</li>
						<li class="small line">
							<button onclick="addline(${sp.position})" class="tooltip" id="addline_${sp.position}">
								<img src="/media/plus-small.png"/>
								<span>Add the line to subplot ${sp.position}</span>
							</button>
								value:
								<select id="vtselect_${sp.position}" onchange="popSelect(${sp.position});" class="filter vtselect">
									<option value="" class="firstoption">Please select...</option>
								</select>
								site:
								<select id="siteselect_${sp.position}" onchange="popSelect(${sp.position});" class="filter siteselect">
									<option value="" class="firstoption">Please select...</option>
								</select>
								instrument:
								<select id="instrumentselect_${sp.position}" onchange="popSelect(${sp.position});" class="filter instrumentselect">
									<option value="" class="firstoption">Please select...</option>
								</select>
								marker:
								<select id="markerpicker_${sp.position}">
									<option value="">none</option>
									<option value="x">x</option>
									<option value="o">o</option>
									<option value=".">.</option>
									<option value="|">|</option>
									<option value="+">+</option>
									<option value="*">*</option>
								</select>
								line:
								<select id="linepicker_${sp.position}">
									<option value="-">-</option>
									<option value="">none</option>
									<option value=":">...</option>
									<option value="--">--</option>
									<option value="-.">-.</option>
								</select>
								color:
								<select id="colorpicker_${sp.position}">
									<option value="k" style="background-color: #000;">k</option>
									<option value="b" style="background-color: #00F;">b</option>
									<option value="g" style="background-color: #0F0;">g</option>
									<option value="r" style="background-color: #F00;">r</option>
									<option value="y" style="background-color: #FF0;">y</option>
									<option value="c" style="background-color: #0FF;">c</option>
									<option value="m" style="background-color: #F0F;">m</option>
								</select>
						</li>
					</ul>

				</li>
				<li class="sp">
					<button id="addsubplot" onclick="javascript:addsubplot()" class="tooltip">
						<img src="/media/plus-small.png"/>
						<span>Add a new subplot to the figure</span>
					</button>
						add subplot
				</li>
			</ul>
		</div>
		<a href="/plot/image.pdf?create=${plot.createtime}">Plot as pdf...</a>
		<h2><a href="javascript:renderplot('plot',Date.now())">&#x25BE; Load plot</a></h2>
		<div id="plot">
			
		</div>
	</div>

</body>
</html>