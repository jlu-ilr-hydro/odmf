<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:py="http://genshi.edgewall.org/">

<head>
	<link href="/media/iconilr.css" rel="stylesheet" type="text/css"/>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
  <link href="/media/jquery-ui-1.8.18.custom.css" rel="stylesheet" type="text/css"/>
	<script src="/media/jquery-1.7.1.min.js" type="text/javascript" />
  <script src="/media/jquery-ui-1.8.18.custom.min.js" type="text/javascript" />
  <script>
      $(function() {$(".datepicker").datepicker({maxDate:"0", dateFormat: 'dd.mm.yy' });});
      
      function setmsg(text,label) {
      	document.msgform.msg.value = text;
      	document.getElementById('msghint').innerHTML = label;
      }
  </script>

	<title>Sites</title>
	<style type="text/css">
  	   input { /*width: 100%;*/}
  	   .msghint {
  	   	font-weight: bold;
  	   	color: red;
  	   }
	  select { width: 100%;}

	</style>	
</head>
<body onload="initialize()">
	${navigation()}
    <div> 
		<div>
			<form>Select a site:
				<select onchange="location.href=this.options[this.selectedIndex].value"
						style="width: 20em;">
					<option py:for="s in sites"
									value="${'/site/%i' % s.id}"
									py:attrs="markoption(s is actualsite)"
									py:content="s" /> 
				</select>
			</form>
		</div>
		<div py:if="actualsite">
			<h1 py:content="'Actual site #%i' % actualsite.id" />
			<p py:content="actualsite" />
			<p py:content="actualsite.comment" />
			<h2>Messages for this site</h2>
			<p>
				Please report briefly any actions you have performed on this site, or if you observed something unusual.
			</p>
			<ul>
				<li>
					<a href="/log/new?siteid=${actualsite.id}" style="font-style: italic;">New message...</a>
					<!--<div class="msghint" id="msghint" /> 
					<form method="POST" action="/site/addmsg" name="msgform">
							<input type="submit" value="New message:" />
							<input name="message" id="msg" size="50"/>
							<input class="datepicker" name="msgdate" value="${formatdate()}" /><br />
							<input type="button" name="msgbutton1" value="sample taken"
 										 onclick="setmsg('sample taken','Report time and water level/discharge (if applicable) to your message');" />
							<input type="button" name="msgbutton2" value="logger exchange"
										onclick="setmsg('logger exchange','Report time and water level/discharge (if applicable) to your message');" />

								<span style="visibility: collapse">
									<input name="site" value="${actualsite.id}" />
								</span>
					</form>
					-->
				</li>
				<li py:for="log in actualsite.logs">
					<a href="/log/${log.id}" py:content="'%s, %s: %s' % (formatdate(log.time),log.user,log.message)" />
				</li>
			</ul>
			<h2>Installed instruments</h2>
			<ul>
				<li py:for="inst in actualsite.instruments"
					py:content="'%s: %s (%s)' % (formatdate(inst.installdate),inst.instrument.name,inst.instrument.sourcetype)" />
			</ul>
			<h2>Available datasets</h2>
			<ul>
				<li>
					<a href="/dataset/new?site_id=${actualsite.id}"
					py:content="'Add new dataset...'" style="font-style: italic;" />
				</li>
				<li py:for="ds in actualsite.datasets">
					<a href="/dataset/${ds.id}?site_id=${actualsite.id}" 
					py:content="'%s (%s-%s)' % (ds,formatdate(ds.start),formatdate(ds.end))" />
				</li>
			</ul>
		</div>
	</div>
</body>
</html>
