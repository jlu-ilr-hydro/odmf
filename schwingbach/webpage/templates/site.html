<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:py="http://genshi.edgewall.org/">

<head>
	<link href="/media/iconilr.css" rel="stylesheet" type="text/css"/>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
  <link href="/media/jquery-ui-1.8.18.custom.css" rel="stylesheet" type="text/css"/>
	<script src="/media/jquery-1.7.1.min.js" type="text/javascript" />
  <script src="/media/jquery-ui-1.8.18.custom.min.js" type="text/javascript" />
  <script>
      function popSelect() {
      	$.getJSON('/site/json',[],function(data){
	  		var html=''
	  		$.each(data,function(index,item){
	  			if (item.id != ${actualsite.id}) { 
	  				html += '<option value="/site/' + item.id + '">' +    item.text + '</option>'
	  			} else {
	  				html += '<option value="/site/' + item.id + '" selected="selected">' +    item.text + '</option>'
	  			}
	  		});
	  		$('#siteselect').html(html)
	  	});
      }
      function startedit(id) {
      	if ($('#editarea').html()=='') {
      		$('#editarea').load('/site/edit',{siteid : id});
      	} else {
      		$('#editarea').html('');
      	}
      }
      $(function() {
      	$('.datepicker').datepicker({maxDate:"0", dateFormat: 'dd.mm.yy' });
      	popSelect();   	
      });
      
      
  </script>

	<title>Sites</title>
	<style type="text/css">
  	   input { /*width: 100%;*/}
  	   .msghint {
  	   	font-weight: bold;
  	   	color: red;
  	   }
	  select { width: 100%;}

	</style>	
</head>
<body onload="initialize()">
	${navigation()}
    <div> 
		<div>
			<form>Select a site:
				<select onchange="location.href=this.options[this.selectedIndex].value"
						
						id="siteselect"
						style="width: 20em;">
				</select>
			</form>
		</div>
		<div py:if="actualsite">
			<h1 py:content="'Actual site #%i' % actualsite.id" />
			<p py:content="actualsite" />
			<p py:content="actualsite.comment" />
			<p>
				<input type="button" onclick="startedit(${actualsite.id})" value="Edit..." />
				<input type="button" onclick="startedit('new')" value="New..." />
	
			</p>
			<div id="editarea" />
			<h2>Messages for this site</h2>
			<p>
				Please report briefly any actions you have performed on this site, or if you observed something unusual.
			</p>
			<ul>
				<li>
					<a href="/log/new?siteid=${actualsite.id}" style="font-style: italic;">New message...</a>
				</li>
				<li py:for="log in actualsite.logs">
					<a href="/log/${log.id}" py:content="'%s, %s: %s' % (formatdate(log.time),log.user,log.message)" />
				</li>
			</ul>
			<h2>Installed instruments</h2>
			<ul>
				<li py:for="inst in actualsite.instruments"
					py:content="'%s: %s (%s)' % (formatdate(inst.installdate),inst.instrument.name,inst.instrument.sourcetype)" />
			</ul>
			<h2>Available datasets</h2>
			<ul>
				<li>
					<a href="/dataset/new?site_id=${actualsite.id}"
					py:content="'Add new dataset...'" style="font-style: italic;" />
				</li>
				<li py:for="ds in actualsite.datasets">
					<a href="/dataset/${ds.id}?site_id=${actualsite.id}" 
					py:content="'%s (%s-%s)' % (ds,formatdate(ds.start),formatdate(ds.end))" />
				</li>
			</ul>
		</div>
	</div>
</body>
</html>
