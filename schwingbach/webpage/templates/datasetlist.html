<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
"http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:py="http://genshi.edgewall.org/">

<head>
	
	<link href="/media/iconilr.css" rel="stylesheet" type="text/css"/>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<title>Datasets</title>
	<link href="/media/jquery-ui-1.8.18.custom.css" rel="stylesheet" type="text/css"/>
  <script src="/media/jquery-1.7.1.min.js" type="text/javascript" ></script>
  <script src="/media/jquery-ui-1.8.18.custom.min.js" type="text/javascript" ></script>

    <script>
    	//<[CDATA[
    		function popSelect() {
    			var vt = $('#vtselect').val()
    			var user = $('#userselect').val()
    			var site = $('#siteselect').val()
    			var date = $('#dateselect').val()
				$.getJSON('/dataset/attrjson',
									{ attribute:'valuetype',
									  user:user,
									  site:site,
									  date:date
									},
									function(data){
										var html='<option value="">Please select...</option>';
										$.each(data,function(index,item){
											html+='<option value="'+item.id+'">'+item.name+'</option>';
										});
										$('#vtselect').html(html).val(vt);
									}
				);
						
				$.getJSON('/dataset/attrjson',
									{ attribute:'measured_by',
									  valuetype:vt,
									  site:site,
									  date:date
									},
									function(data){
										var html='<option value="">Please select...</option>';
										$.each(data,function(index,item){
											html+='<option value="'+item.username+'">'+item.firstname+' '+item.surname+'</option>';
										});
										$('#userselect').html(html).val(user);
									}
				);		

				$.getJSON('/dataset/attrjson',
									{ attribute:'site',
									  valuetype:vt,
									  user:user,
									  date:date
									},
									function(data){
										var html='<option value="">Please select...</option>';
										$.each(data,function(index,item){
											html+='<option value="'+item.id+'">#'+item.id+' ('+item.name+')</option>';
										});
										$('#siteselect').html(html).val(site);
									}
				);
				if (vt!='' || user!='' || site!='' || date!='') {
					setFilter();
				}
    		}
    		function setFilter() {
    			// Linklist to datasets
    			var vt = $('#vtselect').val()
    			var user = $('#userselect').val()
    			var site = $('#siteselect').val()
    			var date = $('#dateselect').val()
				$.getJSON('/dataset/json',
									{ valuetype: vt,
										user:user,
										site:site,
										date:date,
									},
									function(data){
										var html='';
										$.each(data,function(index,item){
											html+='<li><a href="/dataset/'+
														item.id+'">'+item.label+'</a></li>'
											});
										$('#dslist').html(html);
									}
				);    			
    		}
    		function clearFilter() {
    			$('.filter').val('')
    			$('#dateselect').val('')
    			popSelect();
    			$('#dslist').html('')
    		}
    		$(function() {
  					//$('#navigation').load('/navigation');
    				$(".datepicker").datepicker({maxDate:"0", dateFormat: 'dd.mm.yy' });
	    			popSelect();

	   		});
        //]]>
    </script>
		<style>
			select {width:100%;}
			.filter {width: 10em;}
		</style>

</head>
<body>
	${navigation()}
	<div class="content">
		<h1>Datasets</h1>
		<div>
			<h2>Filter:</h2>
			value type:
			<select id="vtselect" onchange="popSelect();" class="filter">
				<option value="">Please select...</option>
			</select>
			site:
			<select id="siteselect"  onchange="popSelect();" class="filter">
				<option value="">Please select...</option>
			</select>
			user:
			<select id="userselect"  onchange="popSelect();" class="filter">
				<option value="">Please select...</option>
			</select>
			date:
			<input id="dateselect" type="text" class="datepicker" value=""  
						onchange="popSelect();" class="filter"/>
			<button onclick="setFilter();">apply filter</button>
			<button onclick="clearFilter();">clear filter</button>
	
		</div>
		<div>
			<h2>List:</h2>
			<ul style="list-style-image: url(/media/shimmer/document_add_48.png)">
				<li>
					<a href="/dataset/new">New dataset...</a>
				</li>
			</ul>
			<ul id="dslist" style="list-style-image: url(/media/shimmer/document_24.png)">
			</ul>
		</div>				
	
	</div>			
	</body>
</html>
