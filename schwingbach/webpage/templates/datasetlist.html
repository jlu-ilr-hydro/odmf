<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:py="http://genshi.edgewall.org/">

<head>
	
	<link href="/media/iconilr.css" rel="stylesheet" type="text/css"/>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<title>Datasets</title>
	<link href="/media/jquery-ui-1.8.18.custom.css" rel="stylesheet" type="text/css"/>
    <script src="/media/jquery-1.7.1.min.js" type="text/javascript" ></script>
    <script src="/media/jquery-ui-1.8.18.custom.min.js" type="text/javascript" ></script>
    <script>
    		function popSelect() {
    			vt = $('#vtselect').val()
    			user = $('#userselect').val()
    			site = $('#siteselect').val()
    			date = $('#dateselect').val()
	    			$.getJSON('/dataset/attrjson',
	    								{ attribute:'valuetype',
	    								  user:user,
	    								  site:site,
	    								  date:date
	    								},
	    								function(data){
	    									var html='<option value="">Please select...</option>';
	    									$.each(data,function(index,item){
	    										html+='<option value="'+item.id+'">'+item.name+'</option>';
	    									});
	    									$('#vtselect').html(html).val(vt);
	    								}
	    			);
	    					
		  			$.getJSON('/dataset/attrjson',
	    								{ attribute:'measured_by',
	    									valuetype:vt,
	    								  site:site,
	    								  date:date
	    								},
	    								function(data){
	    									var html='<option value="">Please select...</option>';
	    									$.each(data,function(index,item){
	    										html+='<option value="'+item.username+'">'+item.firstname+' '+item.surname+'</option>';
	    									});
	    									$('#userselect').html(html).val(user);
	    								}
	    			);		

	    			$.getJSON('/dataset/attrjson',
	    								{ attribute:'site',
	    									valuetype:vt,
	    								  user:user,
	    								  date:date
	    								},
	    								function(data){
	    									var html='<option value="">Please select...</option>';
	    									$.each(data,function(index,item){
	    										html+='<option value="'+item.id+'">#'+item.id+' ('+item.name+')</option>';
	    									});
	    									$('#siteselect').html(html).val(site);
	    								}
	    			);	
	    			$.getJSON('/dataset/json',
	    								{ valuetype: vt,
	    									user:user,
	    									site:site,
	    									date:date,
	    								},
	    								function(data){
	    									var html='';
	    									$.each(data,function(index,item){html+='<li><a href="/dataset/'+item.id+'">'+item.name+'</a></li>'});
	    									$('#dslist').html(html);
	    								}
	    				
	    			);
	    			

    			
    		}
    		function clearfilter() {
    			$('.filter').val('')
    			$('#dateselect').val('')
    			popSelect();
    		}
    		$(function() {
    				$(".datepicker").datepicker({maxDate:"0", dateFormat: 'dd.mm.yy' });
	    			popSelect();
	   		});
        
    </script>
		<style>
			select {width:100%;}
			.filter {width: 10em;}
		</style>

</head>
<body>
	${navigation()}
	
	<h1>Datasets</h1>
	<div>
		<h2>Filter:</h2>
		value type:
		<select id="vtselect" onchange="popSelect();" class="filter">
			<option value="">Please select...</option>
		</select>
		site:
		<select id="siteselect"  onchange="popSelect();" class="filter">
			<option value="">Please select...</option>
		</select>
		user:
		<select id="userselect"  onchange="popSelect();" class="filter">
			<option value="">Please select...</option>
		</select>
		date:
		<input id="dateselect" type="text" class="datepicker" value=""  
					onchange="popSelect();" class="filter"/>
		<input type="button" onclick="clearfilter();" value="clear filter" />

	</div>
	<h2>List:</h2>
	<ul>
		<li>
			<a href="/dataset/new">New dataset...</a>
		</li>
	</ul>
	<ul id="dslist">
	</ul>
			
	</body>
</html>
