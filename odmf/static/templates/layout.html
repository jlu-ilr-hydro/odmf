<!DOCTYPE html>
<html lang="en" xmlns:py="http://www.w3.org/1999/xhtml">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

    <title>${title}</title>

    <link rel="icon" type="image/png" href="${conf.root_url}/media/ilr-favicon.png" />

    <link rel="stylesheet" href="${conf.url('node_modules')}/bootstrap/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="${conf.url('node_modules')}/@fortawesome/fontawesome-free/css/fontawesome.min.css" />
    <link rel="stylesheet" href="${conf.url('node_modules')}/select2/dist/css/select2.min.css" />
    <link rel="stylesheet"
        href="${conf.url('node_modules')}/select2-bootstrap-5-theme/dist/select2-bootstrap-5-theme.min.css" />
    <link rel="stylesheet" type="text/css" href="${conf.root_url}/media/css/bootstrap-odmf.css" />

    <style py:block="style" />

    <script>function odmf_ref(s) { return '${conf.root_url}' + s; }</script>
    <!-- # MathJax 3 - newest plotly might work with it -->
    <script>
        MathJax = {
            tex: {
                inlineMath: [['$~', '~$'], ['\\(', '\\)']]
            },
            svg: {
                fontCache: 'global'
            }
        };
    </script>

    <script src="${conf.url('node_modules')}/mathjax/es5/tex-mml-chtml.js"></script>
    <script src="${conf.url('node_modules')}/jquery/dist/jquery.min.js"></script>
    <script src="${conf.url('node_modules')}/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
    <script src="${conf.url('node_modules')}/@fortawesome/fontawesome-free/js/all.min.js"></script>
    <script src="${conf.url('node_modules')}/select2/dist/js/select2.min.js"></script>

    <script>
        //<![CDATA[
        function toggleSidebar() {
            const sidebar = new bootstrap.Collapse('#sidebar');
            sidebar.toggle();
            $('#sidebarToggle').toggleClass('collapsed');
        }

        function datetime_local_now() {
            // https://stackoverflow.com/a/60884408/3032680
            var now = new Date();
            now.setMinutes(now.getMinutes() - now.getTimezoneOffset());

            /* remove second/millisecond if needed - credit ref. https://stackoverflow.com/questions/24468518/html5-input-datetime-local-default-value-of-today-and-current-time#comment112871765_60884408 */
            now.setMilliseconds(null)
            now.setSeconds(null)
            return now.toISOString().slice(0, -1);
        }
        function set_message(msg_type, msg) {
            let id = '#' + msg_type + '-msg'
            $(id).toggleClass('d-none', !(msg))
            $(id + ' p').html(msg)
        }
        set_error = msg => { return set_message('error', msg) }
        set_info = msg => { return set_message('info', msg) }
        set_success = msg => { return set_message('success', msg) }

        $(function () {
            $('[data-bs-toggle="tooltip"]').tooltip();

            $('.select2').select2({
                theme: 'bootstrap-5',
                width: '100%'
            })
            $('.select2-tags').select2({
                theme: 'bootstrap-5',
                width: '100%',
                tags: true
            })

            $('#login-logout').on('click', () => {
                $.post('${conf.root_url}/api/logout').done(() => {
                    window.location.reload()
                })
            })
            $('#login-btn').on('click', function () {
                $.post('${conf.root_url}/api/login', $('#login-form').serialize())
                    .done(function () {
                        var curLoc = window.location.href;
                        curLoc = curLoc.replace(/error\=[^&]*/, '')
                            .replace('?&', '?')
                            .replace(/\?$/, '')
                            .replace('&&', '&');
                        window.location.replace(curLoc);
                    })
                    .fail(
                        function (response) {
                            set_error(response.responseText)
                        });
                return false;
            });
            $('.close-button').on('click', function () {
                $(this).parent().parent().addClass('d-none');
            })
            $('.datetime-local-now').val(datetime_local_now())
            $(".sidebar-list-filter").on("keyup", function () {
                let value = $(this).val().toLowerCase();
                let target = $(this).data('target')
                $(target + ' a').filter(function () {
                    $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
                });
            });
            $('#sidebarToggle').on('click', function () {
                toggleSidebar();
            });
            $('.sidebar').on('focusout', function () {
                const sidebar = new bootstrap.Collapse('#sidebar');
                sidebar.hide();
            });

        });
        //]]>
    </script>
    <script py:block="scripts" />


</head>

<body>
    <!-- Horizontal navbar
Template: https://getbootstrap.com/docs/4.4/components/navbar/
-->

    <nav class="navbar navbar-dark navbar-expand-md sticky-top bg-dark navbar-for-all">
        <div py:if="conf.sandbox" class="text-danger text-nowrap w-100 position-absolute top-0 start-0" style="background-color: #600;z-index: 1">
            <h1>Sandbox, not for real data! Sandbox, not for real data! Sandbox, not for real data! Sandbox, not for real data! Sandbox, not for real data! Sandbox, not for real data! Sandbox, not for real data! Sandbox, not for real data! </h1>
        </div>

        <div class="container-fluid" style="z-index: 100;">
            <button class="nav-item toggle-btn d-lg-none" id="sidebarToggle" type="button" aria-controls="sidebar"
                aria-expanded="false" title="toggle sidebar" aria-label="Toggle sidebar navigation">
                <i class="fas fa-caret-right fa-lg"></i>
            </button>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#nav-icons"
                aria-controls="nav-icons" aria-expanded="false" aria-label="Toggle navigation">
                <i class="fas fa-bars fa-lg" />
            </button>
            <div id="nav-icons" class="collapse navbar-collapse">
                <div class="ms-auto me-auto text-light btn-group">
                    <a py:for="resource in nav_items" py:if="resource.icon" href="${resource.uri}"
                        title="${resource.name}" class="btn btn-secondary" data-bs-toggle="tooltip"
                        data-bs-placement="bottom">
                        <i class="fas fa-${resource.icon} " />
                    </a>
                </div>
                <div class="nav-item dropdown">
                    <a class="btn btn-dark dropdown-toggle " id="login-link" href="#" data-bs-toggle="dropdown"
                        aria-haspopup="true" aria-expanded="false" title="login">
                        <i class="fas fa-user-circle me-2" /><span py:content="users.current or 'login'"></span>
                    </a>
                    <div class="dropdown-menu bg-dark dropdown-menu-right text-light" aria-labelledby="login-link"
                        style="min-width: 15rem;">
                        <form id="login-form" class="m-2 p-2 bg-light border-rounded text-dark">
                            <label for="login-username">Username</label>
                            <input type="text" class="form-control" id="login-username" name="username" />
                            <label for="login-password">Password:</label>
                            <input type="password" name="password" id="login-password" class="form-control" />
                        </form>
                        <div id="login-error" />
                        <div class="p-2 d-flex flex-row justify-content-between align-items-center">
                            <button id="login-btn" class="btn btn-primary">log in</button>
                            <button id="login-logout" class="btn btn-secondary  ms-1">log out</button>
                            <a href="${conf.url('help', 'data-usage')}" class="btn btn-dark ms-1"
                                title="Data usage policy" data-bs-toggle="tooltip" data-bs-placement="bottom">
                                <i class="fas fa-user-shield"></i>
                            </a>

                        </div>

                    </div>
                </div>
            </div>
            <div class="nav-item d-none d-xl-block">
                <div class="">
                    <img src="${conf.url(conf.nav_left_logo)}" alt="${conf.url(conf.nav_left_logo)}"
                        class="logo mt-2" />
                </div>
            </div>

        </div>
    </nav>

    <div class="container-fluid mt-1">
        <div class="row h-100">
            <nav class="col-lg-3 col-md-6 col-9 collapse collapse-horizontal d-lg-block bg-light position-fixed sidebar"
                id="sidebar">
                <div class="sidebar-sticky">
                    <div class="nav flex-column">
                        <div py:block="sidebar"></div>
                    </div>

                </div>
            </nav>
            <main role="main" class="ms-sm-auto col-lg-9 p-0 h-100">
                <div class="container-fluid">

                    <div id="error-msg" class="alert alert-danger w-100 ${dnone_if(not error)}" role="alert">
                        <div class="d-flex flex-row">
                            <div class="me-2">
                                <i class="fas fa-exclamation-circle fa-3x" />
                            </div>
                            <div class="">
                                <p class="lead" id="errortext" py:content="markdown(error)" />
                            </div>
                            <a class="ms-auto btn-close close-button" aria-label="close"></a>
                        </div>
                    </div>
                    <div id="info-msg" class="alert alert-info w-100 ${dnone_if(not info)}" role="alert">
                        <div class="d-flex flex-row">
                            <div class="me-2">
                                <i class="fas fa-info-circle fa-3x" />
                            </div>
                            <div class="">
                                <p class="lead" py:content="markdown(info)" />
                            </div>
                            <a class="ms-auto close-button">
                                <i class="fas fa-times" />
                            </a>
                        </div>
                    </div>
                    <div id="success-msg" class="alert alert-success w-100 ${dnone_if(not success)}" role="alert">
                        <div class="d-flex flex-row">
                            <div class="me-2">
                                <i class="fas fa-info-circle fa-3x" />
                            </div>
                            <div class="">
                                <p class="lead" py:content="markdown(success)" />
                            </div>
                            <a class="ms-auto close-button">
                                <i class="fas fa-times" />
                            </a>
                        </div>
                    </div>

                </div>
                <div
                    class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pb-2 mb-3 border-bottom position-relative">
                    <p py:block="content">

                    </p>
                </div>
            </main>
        </div>
    </div>

    <p py:block="extrahtml"></p>


</body>

</html>